<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <link rel="stylesheet" href="styles/cadastro_empresa.css">
    <title>Cadastro Empresa | CheeseTech Solutions</title>
</head>

<body>
    <div class="main-cadastro">
        <div class="left-cadastro">
            <h1>Registre sua empresa<br>E entre em contato</h1>
            <img src="img/logo2.png" class="left-cadastro-image" alt="logo da empresa">
        </div>
        <div class="right-cadastro">
            <div class="card-cadastro">
                <div id = "div_cpnj" class="text-field">
                    <label for="cnpj">CNPJ</label>
                    <input type="text" id="input_CNPJ" class = "" placeholder="XX.XXX.XXX/XXXX-XX">
                    <div id="erro_cnpj"></div>
                </div>
                <div id = "div_empresa" class="text-field">
                    <label for="empresa">Empresa</label>
                    <input type="text" id="input_empresa" class = "" placeholder="ex: Cheese Tech">
                    <div id="erro_empresa"></div>
                </div>
                <div id = "div_email" class="text-field">
                    <label for="email">Email empresarial</label>
                    <input type="text" id="input_email_empresarial" class = "" placeholder="ex: email@empresarial.com">
                    <div id="erro_email"></div>
                </div>
                <div id = "div_telefone" class="text-field">
                    <label for="telefone">Telefone</label>
                    <input type="text" id="input_telefone" class = "" placeholder="(XX)XXXXX-XXXX">
                    <div id="erro_telefone"></div>
                </div>
                <div id = "div_cep" class="text-field">
                    <label for="cep">CEP</label>
                    <input type="text" id="input_CEP" class = "" placeholder="XXXXX-XXX">
                    <div id="erro_cep"></div>
                </div>
                <div id = "div_qtd" class="text-field">
                    <label for="Qtd Câmara">Número de Câmaras</label>
                    <input type="number" id="input_câmaras" class = "" placeholder="ex: 5">
                </div>
                <button onclick='cadastro()' class="botao-cadastro">Registrar Empresa</button>
            </div>
        </div>
    </div>
</body>
</html>

<script>

    function cadastro() {

        var cnpj = input_CNPJ.value;
        var empresa = input_empresa.value;
        var emailemp = input_email_empresarial.value;
        var telefone = input_telefone.value;
        var cep = input_CEP.value;
        var camara = Number(input_câmaras.value);

        erro_cnpj.innerHTML = "";
        erro_email.innerHTML = "";
        erro_cep.innerHTML = "";
        erro_telefone.innerHTML = "";


        if (cnpj == "" || empresa == "" || emailemp == "" || telefone == "" || cep == "" || camara == "") {
           
           alert("Preencha os campos vazios"); 
           
        } 
        else {

            if (cnpj.length != 18 || cnpj.indexOf('.') == -1 || cnpj.indexOf('/') == -1 || cnpj.indexOf('-') == -1) {
            
                erro_cnpj.innerHTML = 'O cnpj é inválido, por favor verifique o campo inserido'
                input_cnpj.className = `inválido`

            } 

            else if (emailemp.indexOf("@") == -1 || emailemp.endsWith(".com") == false) {

                if(emailemp.indexOf("@") == -1){

                    erro_email.innerHTML = "Email inválido!"
                    erro_email.innerHTML += ` Está faltando o @`

                }
                else if (emailemp.endsWith(".com") == false) {

                    erro_email.innerHTML = "Email inválido!"
                    erro_email.innerHTML += ` Está faltando o ".com"`

                }   

            }

            else if (telefone.length != 14 || telefone.indexOf("(") == -1 || telefone.indexOf(")") == -1 || telefone.indexOf("-") == -1) {
                
                erro_telefone.innerHTML = `O telefone é inválido, por favor verifique o campo inserido`
                input_telefone.className = "invalido"

            } 

            else if (cep.length != 9 || cep.indexOf("-") == -1) {

                erro_cep.innerHTML = `O cep é inválido, por favor verifique o campo inserido `
                input_CEP.className = "invalido"

            } 

            else { // mudar o alert para uma div na página 
                //  mudar.innerHTML = "Cadastro concluído! <br>Direcionando para a página de login"
                
                erro_cep.innerHTML = "";
        
                alert ("Cadastro Concluído com sucesso!")
                 window.location = "index.html";
            }

        }
    
    }

    
</script>

function cadastrar() {
    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var nomeVar = nome_input.value;
    var emailVar = email_input.value;
    var senhaVar = senha_input.value;
    var confirmacaoSenhaVar = confirmacao_senha_input.value;

    erro_email.innerHTML = "";
    erro_senha.innerHTML = "";
    erro_confirmar_senha.innerHTML = "";
    erro_cnpj.innerHTML = "";

    if (nomeVar == "" || emailVar == "" || senhaVar == "" || confirmacaoSenhaVar == "" ) {
        alert("Preencha os campos vazios")

    } else {

         if (emailVar.indexOf("@") == -1 || emailVar.endsWith(".com") == false) {

            erro_email.innerHTML = "email inválido"
            input_email.className = "invalido"
           

            if (emailVar.indexOf("@") == -1) {

                erro_email.innerHTML = `Está faltando o @`
               

            }
            else if (emailVar.endsWith(".com") == false) {

                erro_email.innerHTML = `Está faltando o ".com"`
               
            }

        }

        else if (!/[!@#\$%\^&\*\(\)\-_\+=\[\]{};':"\\|,.<>\/?]/.test(senhaVar)) { /* O sinal de exclamação ! no início inverte o resultado da verificação*/
            erro_senha.innerHTML = 'Senha inválida!'
            erro_senha.innerHTML += ' A senha deve conter pelo menos um caractere especial.'
            input_senha.className = "invalido"
            
        }

        else if (senhaVar.length < 8) {
            erro_senha.innerHTML = 'Senha inválida!'
            erro_senha.innerHTML += ' Precisa ter ao menos 8 dígitos'
            input_senha.className = 'invalido'
            
        }

        else if
            (confirmacaoSenhaVar != senhaVar) {
            erro_confirmar_senha.innerHTML = `A senha de confirmação não corresponde à senha inserida. Por favor, tente novamente`
            input_confirmar_senha.className = "invalido"
           
        } 
       
    }

    // Enviando o valor da nova input
    fetch("/usuarios/cadastrar", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            // crie um atributo que recebe o valor recuperado aqui
            // Agora vá para o arquivo routes/usuario.js
            nomeServer: nomeVar,
            emailServer: emailVar,
            senhaServer: senhaVar,
        })
    })

    
}